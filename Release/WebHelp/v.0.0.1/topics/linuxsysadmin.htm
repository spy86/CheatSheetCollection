<!DOCTYPE HTML>
<html id="hs-topic-p">
<!-- saved from url=(0025)http://www.helpsmith.com/ -->
<head>
<title>LinuxSysadmin</title>
<meta charset="windows-1250" />
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<meta name="generator" content="HelpSmith 8.0 (Build 18.1202)" />
<style type="text/css" media="screen">
html {
  height: 100%;
}
body {
  margin: 0 8px 0 8px;
}
</style>
<link type="text/css" rel="stylesheet" href="../css/topics/style.css" />
<script type="text/javascript" src="../js/jquery-3.3.1.min.js"></script>
<script type="text/javascript" src="../js/settings.js?1845a896"></script>
<script type="text/javascript" src="../js/core.min.js?392d0f49"></script>
<script type="text/javascript" src="../js/topic.min.js?392d0f49"></script>
<script type="text/javascript">
	var topicContext = 440;
</script>
</head>
<body>
<p class="ps0"><span class="ts0">Hardware</span></p>
<p class="ps6"><span class="ts3">Info</span></p>
<p class="ps5"><span class="ts2">Commands</span></p>
<p class="ps9"><span class="ts5">&nbsp;&nbsp;&nbsp; lsusb</span><br /><span class="ts5">&nbsp;&nbsp;&nbsp; lspci</span><br /><span class="ts5">&nbsp;&nbsp;&nbsp; lsha</span><br /><span class="ts5">&nbsp;&nbsp;&nbsp; dmidecode</span><br /><span class="ts5">&nbsp;&nbsp;&nbsp; dmidecode -s system-product-name</span><br /><span class="ts5">&nbsp;&nbsp;&nbsp; hdparm -I /dev/....</span><br /><span class="ts5">&nbsp;&nbsp;&nbsp; smartctl -a /dev/...</span><br /><span class="ts6">&nbsp;</span></p>
<p class="ps15"><span class="ts3">Performance</span></p>
<p class="ps8"><span class="ts4">I/O</span></p>
<p class="ps2"><span style="font-size: 14pt; line-height: 0; vertical-align: middle; color: Black">&bull;</span><span style="display: inline-block; width: 24px"></span><a href="http://www.bluestop.org/fio/" class="hs0">fio</a><span class="ts2">: Synthetic IO stress test</span></p>
<p class="ps2"><span style="font-size: 14pt; line-height: 0; vertical-align: middle; color: Black">&bull;</span><span style="display: inline-block; width: 24px"></span><a href="http://www.iozone.org/" class="hs0">iozone</a><span class="ts2">: Synthetic FS benchmark</span></p>
<p class="ps2"><span style="font-size: 14pt; line-height: 0; vertical-align: middle; color: Black">&bull;</span><span style="display: inline-block; width: 24px"></span><span class="ts2">Configure Linux disk IO scheduler</span></p>
<p class="ps1"><span class="ts8">echo deadline &gt; /sys/block/sda/queue/scheduler</span><br />&nbsp;</p>
<p class="ps8"><span class="ts4">CPU</span></p>
<p class="ps1"><span style="font-size: 14pt; line-height: 0; vertical-align: middle; color: Black">&bull;</span><span style="display: inline-block; width: 24px"></span><a href="http://www.roylongbottom.org.uk/whetstone.htm" class="hs0">whetstone</a></p>
<p class="ps1"><span style="font-size: 14pt; line-height: 0; vertical-align: middle; color: Black">&bull;</span><span style="display: inline-block; width: 24px"></span><a href="http://www.netlib.org/benchmark/dhry-c" class="hs0">dhrystone</a></p>
<p class="ps1"><span style="font-size: 14pt; line-height: 0; vertical-align: middle; color: Black">&bull;</span><span style="display: inline-block; width: 24px"></span><a href="https://packages.debian.org/sid/stress" class="hs0">stress</a></p>
<p class="ps8"><span class="ts4">Metrics</span></p>
<p class="ps5"><span class="ts2">Human readable sar output</span></p>
<p class="ps9"><span class="ts5">sar -n DEV 1 1 # e.g. show recent Device I/O </span><br /><br /><span class="ts5"># Save one complete sample if you have no collection enabled </span><br /><span class="ts5">sar -o /tmp/sar.out -n ALL 1 1 </span><br /><span class="ts6">&nbsp;</span></p>
<p class="ps10"><span class="ts2">Machine readable: you need to use sadf</span></p>
<p class="ps9"><span class="ts5">sadf -j /tmp/sar.out -- -n DEV&nbsp;&nbsp;&nbsp; # All in nice JSON</span><br /><span class="ts6">&nbsp;</span></p>
<p class="ps8"><span class="ts4">Theory</span></p>
<p class="ps1"><span style="font-size: 14pt; line-height: 0; vertical-align: middle; color: Black">&bull;</span><span style="display: inline-block; width: 24px"></span><a href="http://www.brendangregg.com/usemethod.html" class="hs0">USE (Utilization Saturation and Errors) Method</a></p>
<p class="ps1"><span style="font-size: 14pt; line-height: 0; vertical-align: middle; color: Black">&bull;</span><span style="display: inline-block; width: 24px"></span><a href="http://www.brendangregg.com/blog/2017-05-15/container-performance-analysis-dockercon-2017.html" class="hs0">Docker Perfomance Analysis</a></p>
<p class="ps1"><span style="font-size: 14pt; line-height: 0; vertical-align: middle; color: Black">&bull;</span><span style="display: inline-block; width: 24px"></span><a href="http://www.brendangregg.com/blog/2017-05-09/cpu-utilization-is-wrong.html?utm_content=bufferfb890&amp;utm_medium=social&amp;utm_source=twitter.com&amp;utm_campaign=buffer" class="hs0">CPU Utilization is wrong</a></p>
<p class="ps7"><span class="ts3">Misc</span></p>
<p class="ps2"><span style="font-size: 14pt; line-height: 0; vertical-align: middle; color: Black">&bull;</span><span style="display: inline-block; width: 24px"></span><span class="ts2">Check for pending leap seconds:</span></p>
<p class="ps2"><span class="ts8">ntpq -c&quot;rv 0 leap&quot;</span><br />&nbsp;</p>
<p class="ps2"><span style="font-size: 14pt; line-height: 0; vertical-align: middle; color: Black">&bull;</span><span style="display: inline-block; width: 24px"></span><span class="ts2">supervisor - Start CLI with</span></p>
<p class="ps2"><span class="ts8">supervisorctl</span><br />&nbsp;</p>
<p class="ps2"><span class="ts2">CLI Commands</span></p>
<p class="ps2"><span class="ts8">start &lt;name&gt;</span><br /><span class="ts8">stop &lt;name&gt;</span><br /><span class="ts8">restart all</span><br /><span class="ts8">tail &lt;name&gt;&nbsp;&nbsp; # JSON log</span><br />&nbsp;</p>
<p class="ps2"><span style="font-size: 14pt; line-height: 0; vertical-align: middle; color: Black">&bull;</span><span style="display: inline-block; width: 24px"></span><span class="ts2">sudo - Solving issue</span></p>
<p class="ps2"><span class="ts8">nagios sudo: no tty present and no askpass program specified</span><br />&nbsp;</p>
<p class="ps2"><span class="ts2">by adding</span></p>
<p class="ps2"><span class="ts8">Defaults:&lt;user name&gt; !requiretty</span><br /><span class="ts8">Defaults:&lt;user name&gt; !visiblepw</span><br />&nbsp;</p>
<p class="ps2"><span class="ts2">at the end of /etc/sudoers. Note that this issue can also indicate a password prompt when you run a different command than you expect. In any case if you can't solve it check /var/log/auth.log to see what the real command is.</span></p>
<p class="ps2"><span style="font-size: 14pt; line-height: 0; vertical-align: middle; color: Black">&bull;</span><span style="display: inline-block; width: 24px"></span><span class="ts2">sudo - List user permissions:</span></p>
<p class="ps2"><span class="ts8">sudo -l -U &lt;user&gt;</span><br />&nbsp;</p>
<p class="ps2"><span style="font-size: 14pt; line-height: 0; vertical-align: middle; color: Black">&bull;</span><span style="display: inline-block; width: 24px"></span><span class="ts2">pv - Visualize pipe progress:</span></p>
<p class="ps2"><span class="ts8">pv -cN source &lt; linux-3.4.0.tar.bz2 | bzcat | pv -cN bzcat | gzip -9 | pv -cN gzip &gt; linux-3.4.0.tar.gz</span><br />&nbsp;</p>
<p class="ps2"><span style="font-size: 14pt; line-height: 0; vertical-align: middle; color: Black">&bull;</span><span style="display: inline-block; width: 24px"></span><span class="ts2">Fix broken text encoding:</span></p>
<p class="ps2"><span class="ts8">iconv -c -t ASCII input.txt</span><br /><span class="ts8">iconv -c -t latin1 input.txt</span><br />&nbsp;</p>
<p class="ps2"><span style="font-size: 14pt; line-height: 0; vertical-align: middle; color: Black">&bull;</span><span style="display: inline-block; width: 24px"></span><span class="ts2">screen - Detect other users sessions</span></p>
<p class="ps2"><span class="ts8">screen -ls &lt;user name&gt;/</span><br />&nbsp;</p>
<p class="ps2"><span style="font-size: 14pt; line-height: 0; vertical-align: middle; color: Black">&bull;</span><span style="display: inline-block; width: 24px"></span><span class="ts2">screen - Allow othe users in our screen</span></p>
<p class="ps2"><span class="ts8">Ctrl-A :multiuser on</span><br /><span class="ts8">Ctrl-A :acladd &lt;user to grant access&gt;</span><br />&nbsp;</p>
<p class="ps2"><span style="font-size: 14pt; line-height: 0; vertical-align: middle; color: Black">&bull;</span><span style="display: inline-block; width: 24px"></span><span class="ts2">screen - Attach to other users screen session</span></p>
<p class="ps2"><span class="ts8">screen -x &lt;user name&gt;/&lt;session name&gt;</span><br /><span class="ts8">screen -x &lt;user name&gt;/&lt;pid&gt;.&lt;ptty&gt;.&lt;host&gt;</span><br />&nbsp;</p>
<p class="ps2"><span style="font-size: 14pt; line-height: 0; vertical-align: middle; color: Black">&bull;</span><span style="display: inline-block; width: 24px"></span><span class="ts2">screen - </span><a href="http://makandracards.com/makandra/2533-solve-screen-error-cannot-open-your-terminal-dev-pts-0-please-check" class="hs0">Solve &quot;Cannot open your terminal '/dev/pts/0'&quot;</a><span class="ts2">:</span></p>
<p class="ps2"><span class="ts8"># Sign in as user who opened the screen</span><br /><span class="ts8">script /dev/null</span><br /><span class="ts8">screen -x</span><br />&nbsp;</p>
<p class="ps2"><span style="font-size: 14pt; line-height: 0; vertical-align: middle; color: Black">&bull;</span><span style="display: inline-block; width: 24px"></span><span class="ts2">Avoid leap second problems:</span></p>
<p class="ps14"><span style="font-family: 'Courier New'; font-size: 10pt; color: Black">o</span><span style="display: inline-block; width: 22px"></span><span class="ts2">Variant 1: Disable NTP, skip over second</span></p>
<p class="ps14"><span class="ts8"># before leap second</span><br /><span class="ts8">/etc/init.d/ntp stop</span><br /><br /><span class="ts8"># after leap second</span><br /><span class="ts8">date -s &quot;$(LC_ALL=C date)&quot;&nbsp;&nbsp;&nbsp; Note: check correct locale!</span><br /><span class="ts8">/etc/init.d/ntp start</span><br />&nbsp;</p>
<p class="ps14"><span style="font-family: 'Courier New'; font-size: 10pt; color: Black">o</span><span style="display: inline-block; width: 22px"></span><span class="ts2">Variant 2: Ensure NTP is up-to-date and running with -x</span></p>
<p class="ps14"><span style="font-family: 'Courier New'; font-size: 10pt; color: Black">o</span><span style="display: inline-block; width: 22px"></span><span class="ts2">Variant 3: </span><a href="http://syslog.me/2015/06/04/a-humble-attempt-to-work-around-the-leap-second-2015-edition/" class="hs0">Converging solution</a></p>
<p class="ps2"><span style="font-size: 14pt; line-height: 0; vertical-align: middle; color: Black">&bull;</span><span style="display: inline-block; width: 24px"></span><span class="ts2">rsyslog - Modify rate imux limiting</span></p>
<p class="ps2"><span class="ts8">$SystemLogRateLimitInterval 2</span><br /><span class="ts8">$SystemLogRateLimitBurst 50&nbsp; # increase this</span><br />&nbsp;</p>
<p class="ps2"><span style="font-size: 14pt; line-height: 0; vertical-align: middle; color: Black">&bull;</span><span style="display: inline-block; width: 24px"></span><span class="ts2">Running parallel SSH sessions using xargs</span></p>
<p class="ps1"><span class="ts8">echo &quot;$hosts&quot; | xargs --replace={} -t -n 1 -P 15 sh -c &quot;ssh -o StrictHostKeyChecking=no -o PreferredAuthentications=publickey {} date || :&quot;</span><br />&nbsp;</p>
<p class="ps0"><span class="ts0">Runlevel</span></p>
<p class="ps2"><span style="font-size: 14pt; line-height: 0; vertical-align: middle; color: Black">&bull;</span><span style="display: inline-block; width: 24px"></span><span class="ts2">update-rc.d Examples</span></p>
<p class="ps1"><span class="ts8">update-rc.d apache2 defaults&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # creates S20/K20 links</span><br /><span class="ts8">update-rc.d apache2 defaults &lt;nr&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # S&lt;nr&gt;/K&lt;nr&gt;</span><br /><span class="ts8">update-rc.d apache2 defaults &lt;nr1&gt; &lt;nr2&gt;&nbsp; # S&lt;nr1&gt;/K&lt;nr2&gt;</span><br /><br /><span class="ts8"># Really specific </span><br /><span class="ts8">update-rc.d apache2 start 20 2 3 4 5 . stop 80 0 1 6 .</span><br /><br /><span class="ts8">update-rc.d -f apache2 remove&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # Cleanup</span><br />&nbsp;</p>
<p class="ps0"><span class="ts0">Linux CPU Scheduler</span></p>
<p class="ps5"><span class="ts2">Check if CFS is default scheduler</span></p>
<p class="ps9"><span class="ts5">grep cfs_rq /proc/sched_debug</span><br /><span class="ts6">&nbsp;</span></p>
<p class="ps10"><span class="ts2">Check if there are processes not running with CFS (SCHED_OTHER)</span></p>
<p class="ps11"><span class="ts5">ps -ef|grep [0-9]|awk '\{system(&quot;chrt -p &quot; $2);print $0}' | grep -Ev 'priority|SCHED_OTHER' |grep -A1 SCHED</span></p>
<p class="ps3"><br /></p>
<div>
  <hr class="hline0" />
</div>
<p class="ps4"><span class="ts1">Created with an evaluation copy of HelpSmith.</span><br /><span class="ts1">To remove this notice, you should </span><a href="http://www.helpsmith.com/buynow.php" target="_blank" class="hs1">purchase the full version</a><span class="ts1">&nbsp;of the product.</span></p>
</body>
</html>